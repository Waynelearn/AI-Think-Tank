<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Think Tank â€” Multi-agent AI discussion platform. 20 AI personas debate your topics across philosophy, finance, strategy, and more.">
    <title>AI Think Tank</title>
    <link rel="stylesheet" href="/static/style.css?v=12">
    <noscript><style>body{background:#0f1117;color:#e0e0e0;padding:2rem;font-family:sans-serif;}</style></noscript>
</head>
<body>
    <noscript><p>AI Think Tank requires JavaScript to run. Please enable JavaScript in your browser.</p></noscript>
    <div class="container">
        <header>
            <h1>AI Think Tank</h1>
            <p class="subtitle">A round-table of AI minds discussing your topics
                <a href="/help" class="help-link" title="How to use AI Think Tank" aria-label="Help guide">?</a>
                <a href="/admin" class="help-link" title="Usage dashboard" aria-label="Usage dashboard">&#128202;</a>
            </p>
            <div class="header-controls">
                <button id="btn-sentiment" class="icon-btn sentiment-btn" title="Sentiment Analysis" aria-label="Sentiment Analysis">&#128202; Sentiment <span class="sentiment-badge" id="sentiment-badge" style="display:none;"></span></button>
                <button id="btn-theme" class="icon-btn theme-toggle" aria-label="Switch to light mode" title="Toggle theme"><span id="theme-icon">&#9790;</span></button>
                <div class="font-controls" aria-label="Font size controls">
                    <button id="btn-font-dec" class="icon-btn" aria-label="Decrease font size" title="Smaller text">A-</button>
                    <button id="btn-font-inc" class="icon-btn" aria-label="Increase font size" title="Larger text">A+</button>
                </div>
            </div>
        </header>

        <!-- Settings Panel (collapsible) -->
        <div class="settings-panel" role="region" aria-label="Settings">
            <button class="settings-toggle" id="settings-toggle" aria-expanded="false" aria-controls="settings-body">
                <span aria-hidden="true">&#9881;</span> Settings <span aria-hidden="true" id="settings-arrow">&#9660;</span>
            </button>
            <div class="settings-body" id="settings-body">
                <div class="settings-row">
                    <label for="provider-select">Provider</label>
                    <select id="provider-select"></select>
                </div>
                <div class="settings-row">
                    <label for="model-select">Model</label>
                    <select id="model-select"></select>
                </div>
                <div class="settings-row">
                    <label for="api-key-provider">API Key</label>
                    <input type="password" id="api-key-provider" placeholder="sk-ant-..." autocomplete="off">
                </div>
                <div class="settings-row">
                    <label for="api-key-brave">Brave Search Key</label>
                    <input type="password" id="api-key-brave" placeholder="BSA..." autocomplete="off">
                </div>
                <div class="settings-row">
                    <label for="word-limit">Word Limit</label>
                    <input type="number" id="word-limit" min="0" max="5000" step="50" placeholder="0 = no limit" autocomplete="off">
                </div>
                <div class="settings-row">
                    <label for="tone-select">Tone</label>
                    <select id="tone-select">
                        <option value="">Default</option>
                        <option value="layman">Layman (Simple &amp; Clear)</option>
                        <option value="academic">Academic (Scholarly)</option>
                        <option value="professional">Professional (Business)</option>
                        <option value="debate">Debate (Confrontational)</option>
                        <option value="storyteller">Storyteller (Narrative)</option>
                        <option value="socratic">Socratic (Questions-Led)</option>
                    </select>
                </div>
                <div class="settings-actions">
                    <button id="settings-save" class="settings-btn">Save</button>
                    <button id="settings-clear" class="settings-btn settings-btn-danger">Clear</button>
                </div>
                <div class="settings-notice" id="settings-notice" role="status"></div>
            </div>
        </div>

        <!-- Usage Bar -->
        <div class="usage-bar" id="usage-bar" style="display:none;" role="status" aria-label="Token usage">
            <span id="usage-text">Tokens: 0 in / 0 out</span>
            <span id="usage-cost">~$0.00</span>
        </div>

        <div class="agents-bar" id="agents-bar" role="toolbar" aria-label="Agent selection"></div>

        <div class="main-area" role="region" aria-label="Discussion area">
            <!-- Queue toggle (mobile only) -->
            <button id="queue-toggle" class="queue-toggle" aria-expanded="false" aria-controls="queue-panel">Speaker Queue <span aria-hidden="true">&#9660;</span></button>

            <!-- Queue Panel (right side) -->
            <div class="queue-panel" id="queue-panel">
                <div class="queue-header">
                    <span class="queue-title">Speaker Queue</span>
                    <span class="queue-round" id="queue-round">Round 1</span>
                </div>
                <div class="queue-list" id="queue-list"></div>
                <div class="queue-actions">
                    <button id="btn-play" class="q-btn q-play" title="Auto-run all in queue" aria-label="Play all agents in queue">&#9654; Play All</button>
                    <button id="btn-next" class="q-btn q-next" title="Run next agent" aria-label="Run next agent">&#9199; Next</button>
                    <button id="btn-new-round" class="q-btn" title="Start a new round" aria-label="Start new round">&#10227; New Round</button>
                    <button id="btn-end" class="q-btn q-end" title="Stop auto-play" aria-label="Stop auto-play">&#9724; Stop</button>
                    <button id="btn-clear" class="q-btn" title="Clear all agents from queue" aria-label="Clear queue">&#128465; Clear</button>
                    <button id="btn-shuffle" class="q-btn" title="Randomize speaker order" aria-label="Shuffle speaker order">&#128256; Shuffle</button>
                </div>
                <div class="queue-add">
                    <select id="add-agent-select" aria-label="Add agent to queue"><option value="">+ Add agent...</option></select>
                    <button id="btn-add-agent" class="q-btn-sm">Add</button>
                </div>
            </div>

            <!-- Chat Area -->
            <div class="chat-area" id="chat-area" role="log" aria-live="polite" aria-label="Discussion messages">
                <div class="welcome-message">
                    <p>Select agents above, enter a topic, and control the discussion with the queue panel.</p>
                    <p class="welcome-sub">Click agents to toggle. Drag queue items to reorder. Interject anytime.</p>
                </div>
            </div>
        </div>

        <!-- Sentiment Analysis Panel (full-page overlay, triggered from header button) -->
        <div class="sentiment-panel-overlay" id="sentiment-panel" style="display:none;">
            <div class="sentiment-panel" role="region" aria-label="Sentiment analysis panel">
                <div class="sentiment-panel-header">
                    <span class="sentiment-panel-title">&#128202; Sentiment Analysis</span>
                    <div class="sentiment-header-controls">
                        <select id="sentiment-session-select" class="sentiment-session-select" aria-label="Select chat session">
                            <option value="">Current Chat</option>
                        </select>
                        <button class="sentiment-panel-close" id="sentiment-panel-close" aria-label="Close sentiment panel">&times;</button>
                    </div>
                </div>
                <!-- Viewpoint configuration -->
                <div class="sentiment-viewpoint-config">
                    <label class="sentiment-config-label">Points of Contention</label>
                    <div class="viewpoint-inputs">
                        <input type="text" id="viewpoint-a" placeholder="e.g. Regulate AI strictly" autocomplete="off" maxlength="60">
                        <span class="viewpoint-vs">vs</span>
                        <input type="text" id="viewpoint-b" placeholder="e.g. Let markets self-regulate" autocomplete="off" maxlength="60">
                    </div>
                    <span class="viewpoint-hint">Leave blank to auto-detect from Round 1</span>
                </div>
                <!-- Spectrum strip -->
                <div class="sentiment-viewpoint-labels" id="sentiment-viewpoint-labels" style="display:none;">
                    <span class="sentiment-vp-left" id="sentiment-vp-left"></span>
                    <span class="sentiment-vp-center">Neutral</span>
                    <span class="sentiment-vp-right" id="sentiment-vp-right"></span>
                </div>
                <div class="sentiment-strip-inline" id="sentiment-strip-track-panel" style="display:none;"></div>
                <!-- Time-series chart -->
                <div class="sentiment-chart-section" id="sentiment-chart-section" style="display:none;">
                    <span class="sentiment-chart-title">Viewpoint Alignment Over Rounds</span>
                    <canvas id="sentiment-canvas" width="800" height="300"></canvas>
                </div>
                <div class="sentiment-legend" id="sentiment-legend"></div>
                <!-- Qualitative analysis from Sentiment Analyst -->
                <div class="sentiment-commentary" id="sentiment-commentary" style="display:none;">
                    <div class="sentiment-commentary-header">
                        <span class="sentiment-commentary-title">&#128196; Analysis</span>
                        <select id="sentiment-round-select" class="sentiment-round-select" aria-label="Select round"></select>
                    </div>
                    <div class="sentiment-commentary-body" id="sentiment-commentary-body"></div>
                </div>
                <div class="sentiment-empty-state" id="sentiment-empty-state">
                    <p>No sentiment data yet. The Sentiment Analyst will report after speaking in the discussion.</p>
                    <p class="viewpoint-hint">Set your points of contention above, or leave blank for auto-detection.</p>
                </div>
            </div>
        </div>

        <!-- Error region for screen readers -->
        <div id="error-region" role="alert" aria-live="assertive" aria-atomic="true"></div>

        <div class="input-area" role="region" aria-label="Discussion input">
            <div class="controls">
                <button id="btn-new-chat" class="icon-btn" title="Start a fresh discussion" aria-label="Start a fresh discussion">&#10010; New Chat</button>
                <button id="btn-history" class="icon-btn" title="Recent chats" aria-label="Open recent chats">&#128218; History</button>
                <label for="file-upload" class="file-upload-btn" title="Attach files">&#128206; Attach</label>
                <input type="file" id="file-upload" multiple hidden aria-label="Upload files"
                    accept=".csv,.xlsx,.xls,.pdf,.html,.htm,.txt,.md,.json,.log,.py,.js,.ts,.docx,.png,.jpg,.jpeg,.gif,.webp,.mp4,.mov,.avi,.mkv">
                <span id="file-status" class="file-status" role="status"></span>
                <select id="save-format" class="icon-btn" title="Save format" aria-label="Save format">
                    <option value="html">Save as HTML</option>
                    <option value="json">Save as JSON</option>
                </select>
                <button id="download-btn" class="icon-btn" title="Download conversation" aria-label="Download conversation" disabled>&#128190; Save</button>
                <button id="load-btn" class="icon-btn" title="Load previous conversation" aria-label="Load conversation">&#128194; Load</button>
                <input type="file" id="load-input" accept=".json,.html" hidden aria-label="Load conversation file">
            </div>
            <div class="input-row">
                <label for="topic-input" class="sr-only">Discussion topic or message</label>
                <textarea id="topic-input" rows="1" placeholder="Enter a topic for discussion..." autocomplete="off"></textarea>
                <button id="submit-btn">Start</button>
            </div>
        </div>
    </div>

    <script src="/static/utils.js?v=12"></script>
    <script src="/static/app.js?v=12"></script>
</body>
</html>
